---
name: architecture
description: 코드 구조 규칙. 파일 분리, 관심사 분리, 의존성 방향 등 코드를 어디에·어떻게 배치할지 정의합니다.
alwaysApply: true
---

# 코드 구조 규칙

> 코드 품질(에러 처리, 타입, 리소스)은 `coding-style.md`가 담당.

## 우선순위 (충돌 시)

1) 기존 프로젝트의 파일 구조/패턴
2) 프로젝트 문서(`CLAUDE.md`, `agent-guide/*`, `README.md`)
3) 이 파일(`.claude/rules/architecture.md`)

## MUST

- **기존 코드 파악 먼저**: 새 파일/함수 작성 전 (1) 기존 폴더 구조·네이밍 컨벤션 확인 (2) 유사 기능의 기존 유틸/함수 검색 → 있으면 재사용, 없으면 새로 작성. 프로젝트가 `lib/` 패턴이면 `helpers/` 생성 금지
- **단일 역할 원칙**: 한 파일에 UI/비즈니스 로직/데이터 접근/타입/유틸 중 2개 이상 섞이면 분리. 기존 파일에 코드 추가 시에도 복수 역할이 되는지 점검. 무관한 유틸을 API 라우트 등에 추가 금지
- **의존성 단방향**: UI → 비즈니스 로직 → 데이터 접근 → 타입 방향 유지, 순환 의존 금지. 순환 발생 시 공통 모듈 추출 또는 DI/콜백으로 역전

## SHOULD

- **신규 기능은 구조 먼저 제시**: 파일 2개 이상 생성 예상 시, 파일 트리를 먼저 보여주고 사용자와 합의
- **Co-location**: 기능별로 관련 파일을 물리적으로 가까이 배치 (기존 프로젝트 패턴 우선). `features/payment/` 아래 컴포넌트·훅·타입 함께 배치
- **내보내기 경계 명확히**: `index.ts`로 공개 API 명확히, 외부에서 내부 구현 파일 직접 접근 금지

## AVOID

- **만능 서랍/God 모듈**: `utils.ts`에 무관한 함수 누적 금지 → 기능별 분리. 3개 이상 독립 하위 기능을 직접 구현하는 파일은 하위 모듈로 분리
- **과도한 사전 추상화**: 구현체 1개뿐인데 인터페이스+팩토리+DI 만들지 않기. 2개 이상 필요해지면 그때 도입
