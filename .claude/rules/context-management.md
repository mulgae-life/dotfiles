---
name: context-management
description: 컨텍스트 관리 규칙. 장기 세션 품질 유지, 파일시스템 활용, 메모리 계층을 정의합니다.
alwaysApply: true
---

# 컨텍스트 관리 규칙

> 컨텍스트는 유한 리소스. 완전함보다 관련성을 우선한다.

## 악화 패턴 인지

다음 패턴 감지 시 즉시 대응:

| 패턴 | 증상 | 대응 |
|------|------|------|
| **중간 망각** | 대화 중간에 언급된 요구사항 누락 | 핵심 요구사항을 응답 시작부에 재확인 |
| **컨텍스트 오염** | 이전 작업의 잘못된 가정이 현재에 영향 | 새 작업 시작 시 관련 파일 직접 재확인, 기억에 의존 금지 |
| **주의 분산** | 대량 도구 출력으로 핵심 방향 상실 | 스크래치패드 패턴 사용 |

## 파일시스템 활용

### 스크래치패드(Scratchpad)

대량 도구 출력(빌드 로그, 테스트 결과 등 2000 토큰 초과) 처리 시:
1. 출력을 `.claude/scratch/` 파일에 저장
2. 핵심 요약(에러 수, 실패 파일, 핵심 메시지)만 컨텍스트에 유지
3. 상세 내용은 필요 시 파일에서 재읽기

### 계획 영속화

복잡한 작업(3단계 이상)의 계획은 `.claude/plans/`에 저장:
- 구현 중 계획 참조 시 파일에서 재읽기 (기억 의존 금지)
- 구현 완료 후 삭제

### 부에이전트 파일 공유

부에이전트에 컨텍스트 전달 시:
- 분석 대상: 파일 경로로 전달 (내용 복사 금지)
- 분석 결과: `.claude/scratch/`에 저장 → 메인 에이전트가 읽기

## 메모리 계층

| 계층 | 저장소 | 수명 | 용도 |
|------|--------|------|------|
| **활성** | 컨텍스트 윈도우 | 현재 대화 | 진행 중 작업 |
| **세션** | `agent-guide/SESSION.md` | 세션 간 | 작업 상태, 결정사항 |
| **교훈** | `memory/lessons.md` (auto memory) | 영구 | 실수 패턴, 에러 해결법 |
| **프로젝트** | `agent-guide/PROJECT.md` | 영구 | 구조, 스택, 핵심 파일 |

### lessons.md 기록 형식

```
## YYYY-MM-DD: [제목]
- **상황**: [어떤 작업 중]
- **실수/발견**: [무엇이 문제였는지]
- **교훈**: [앞으로 어떻게 해야 하는지]
- **관련 파일**: [해당되는 경우]
```

## 장기 세션 관리

세션이 길어질 때(작업 전환 3회 이상):
1. **앵커링**: 작업 전환 시 "현재 상태 요약"을 명시적으로 수행
2. **중간 저장**: SESSION.md에 진행 상황 기록
3. **정리**: 완료 작업의 상세 컨텍스트는 기록 후 잊기
