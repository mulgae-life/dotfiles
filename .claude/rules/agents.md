---
name: agents
description: 에이전트 자동 위임 오케스트레이션 규칙. 언제 어떤 에이전트를 자동으로 호출할지 정의합니다.
alwaysApply: true
---

# 에이전트 자동 위임 규칙

조건 충족 시 사용자 요청 없이 자동 위임. 조건 미충족 시 Claude 직접 처리.

## 에이전트 및 위임 우선순위

| 순위 | 에이전트 | 트리거 조건 |
|------|----------|------------|
| 1 | `build-resolver` | 빌드 실패 (`npm run build`, `tsc`, `pnpm build` 에러) |
| 2 | `security-reviewer` | 보안 민감 코드 (auth/login/session/token, API 엔드포인트, 암호화, 시크릿) |
| 3 | `planner` | 복잡한 요청 (파일 3개+ 수정 예상, 아키텍처 결정 필요). **초안만 작성** → 사용자와 논의 후 확정 |
| 4 | `verifier` | 작업(코드/문서/리포트/계획서) 완료 후, 또는 "점검해줘/확인해줘" 요청 |

일반 흐름: planner(초안) → 사용자 논의 → 구현 → verifier → (보안 시) security-reviewer → (빌드 에러 시) build-resolver

## 위임 금지 조건

- 단순 질문/설명 요청
- 1-2줄 간단한 수정
- 사용자가 "직접 해줘" 명시적 요청
- 파일 1-2개만 수정하는 간단한 작업

## 에이전트 ↔ 스킬 역할 분담

| 자동 (Agent) | 수동 (Skill) |
|--------------|--------------|
| verifier: 빠른 점검 | `/code-review`: 심층 리뷰 |
| security-reviewer: 자동 체크 | `/code-simplifier`: 코드 간소화 |
| build-resolver: 에러 수정 | `/feedback-analysis`: 피드백 분석 |
| planner: 계획 초안 | `/update-docs`: 문서 업데이트 |

심층 리뷰가 필요할 때는 `/code-review` 스킬을 수동으로 호출.

## 행동 규칙

- **실패 시 재계획**: 구현 중 차단(의존성 충돌, 설계 오류) 발생 시 즉시 중단 → 재계획. 밀어붙이기 금지
- **버그 수정 자율성**: 버그 수정 요청 시 로그/에러/테스트를 직접 추적→수정. 단순 확인 질문 최소화. 범위 확대 시(파일 3개+) 합의
- **교훈 기록**: 사용자로부터 수정/피드백 받으면 실수 패턴을 memory `lessons.md`에 구체적으로 기록
- **플랜 정리**: 구현 완료 후 `.claude/plans/` 내 해당 플랜 파일 삭제

## 에이전트 인수 프로토콜

부에이전트 위임 시 다음 정보를 명시적으로 전달:

| 항목 | 필수 | 설명 |
|------|:----:|------|
| **task** | O | 수행할 작업 (1문장) |
| **context_files** | O | 관련 파일 경로 목록 |
| **constraints** | O | 제약 조건 (변경 범위, API 호환성 등) |
| **expected_output** | - | 기대 출력 형식 |
| **scope_limit** | - | 변경 허용 범위 ("이 파일만" 등) |

### 출력 검증

- 요청 범위를 벗어난 변경이 없는지 확인
- 부에이전트가 전달한 결과를 재작성하지 않기 (전화게임 방지)
